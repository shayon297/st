<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StockTwits Trader Analysis</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0a0a0a;
            color: #e0e0e0;
            line-height: 1.6;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            padding: 40px;
            margin-bottom: 30px;
            border-radius: 16px;
            position: relative;
            overflow: hidden;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: #fff;
            font-weight: 800;
        }

        .subtitle {
            font-size: 1.1rem;
            color: #a0a0a0;
            margin-bottom: 15px;
        }

        .coverage-badge {
            display: inline-block;
            background: linear-gradient(135deg, #4a9eff, #66b3ff);
            color: #fff;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            margin-top: 10px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: linear-gradient(135deg, #1e1e2e 0%, #252538 100%);
            padding: 25px;
            border-radius: 12px;
            border: 1px solid #2a2a3e;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(180deg, #4a9eff, #66b3ff);
        }

        .stat-label {
            font-size: 0.75rem;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1.2px;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .stat-value {
            font-size: 2.2rem;
            font-weight: 800;
            background: linear-gradient(135deg, #4a9eff 0%, #66b3ff 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 6px;
        }

        .stat-subtext {
            font-size: 0.85rem;
            color: #66cc66;
            font-weight: 500;
        }

        .section {
            background: #1a1a2e;
            padding: 35px;
            border-radius: 16px;
            margin-bottom: 30px;
            border: 1px solid #2a2a3e;
        }

        .section-title {
            font-size: 1.6rem;
            margin-bottom: 20px;
            color: #fff;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .section-title::before {
            content: '';
            width: 5px;
            height: 35px;
            background: linear-gradient(180deg, #4a9eff, #66b3ff);
            border-radius: 3px;
        }

        .chart-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .chart-container {
            background: #15152a;
            padding: 25px;
            border-radius: 12px;
            border: 1px solid #2a2a3e;
        }

        .chart-wrapper {
            position: relative;
            height: 300px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        th {
            background: #252538;
            padding: 14px;
            text-align: left;
            font-weight: 700;
            color: #4a9eff;
            text-transform: uppercase;
            font-size: 0.75rem;
            letter-spacing: 1px;
            border-bottom: 2px solid #4a9eff;
        }

        td {
            padding: 14px;
            border-bottom: 1px solid #2a2a3e;
            font-size: 0.9rem;
        }

        tr:hover {
            background: #252538;
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        .badge-ultra { background: linear-gradient(135deg, #ff4444, #cc0000); color: #fff; }
        .badge-short { background: linear-gradient(135deg, #ffaa44, #ff8800); color: #000; }
        .badge-medium { background: linear-gradient(135deg, #66cc66, #44aa44); color: #fff; }
        .badge-long { background: linear-gradient(135deg, #4a9eff, #2266cc); color: #fff; }

        .user-link {
            color: #ff9f4a;
            text-decoration: none;
            font-weight: 600;
        }

        .user-link:hover {
            color: #ffb366;
            text-decoration: underline;
        }

        @media (max-width: 768px) {
            h1 { font-size: 1.8rem; }
            .stats-grid { grid-template-columns: 1fr; }
            .chart-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>StockTwits Trader Intelligence</h1>
            <div class="subtitle">
                Precise strategy, timeframe, and behavior analysis
            </div>
            <div class="coverage-badge" id="coverageBadge">
                Loading...
            </div>
        </header>

        <div class="stats-grid" id="statsGrid">
            <!-- Stats populated dynamically -->
        </div>

        <div class="chart-grid">
            <div class="chart-container">
                <div class="section-title" style="font-size: 1.2rem;">Trading Timeframes</div>
                <div class="chart-wrapper">
                    <canvas id="timeframeChart"></canvas>
                </div>
            </div>

            <div class="chart-container">
                <div class="section-title" style="font-size: 1.2rem;">Trading Strategies</div>
                <div class="chart-wrapper">
                    <canvas id="strategyChart"></canvas>
                </div>
            </div>

            <div class="chart-container">
                <div class="section-title" style="font-size: 1.2rem;">Instrument Preferences (Strict)</div>
                <div class="chart-wrapper">
                    <canvas id="instrumentChart"></canvas>
                </div>
            </div>

            <div class="chart-container">
                <div class="section-title" style="font-size: 1.2rem;">Device Usage</div>
                <div class="chart-wrapper">
                    <canvas id="deviceChart"></canvas>
                </div>
            </div>

            <div class="chart-container">
                <div class="section-title" style="font-size: 1.2rem;">Posting Time Distribution</div>
                <div class="chart-wrapper">
                    <canvas id="timingChart"></canvas>
                </div>
            </div>

            <div class="chart-container">
                <div class="section-title" style="font-size: 1.2rem;">Product Fit Distribution</div>
                <div class="chart-wrapper">
                    <canvas id="productFitChart"></canvas>
                </div>
            </div>
        </div>

        <div class="section">
            <div class="section-title">Top In-App Trading Candidates</div>
            <p style="color: #a0a0a0; margin-bottom: 20px;">
                Users with highest product fit scores for mobile trading
            </p>
            <table>
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>User</th>
                        <th>Fit Score</th>
                        <th>Timeframe</th>
                        <th>Strategy</th>
                        <th>Risk</th>
                        <th>Posts</th>
                        <th>Profile</th>
                    </tr>
                </thead>
                <tbody id="topTradersTable">
                    <tr><td colspan="8" style="text-align: center; padding: 30px;">Loading...</td></tr>
                </tbody>
            </table>
        </div>

        <div class="section">
            <div class="section-title">Key Insights</div>
            <div style="display: grid; gap: 20px;">
                <div style="background: #252538; padding: 20px; border-radius: 8px; border-left: 4px solid #4a9eff;">
                    <div style="font-weight: 700; margin-bottom: 8px; color: #4a9eff;">Options Traders</div>
                    <div id="optionsInsight" style="color: #c0c0c0;">Loading...</div>
                </div>
                <div style="background: #252538; padding: 20px; border-radius: 8px; border-left: 4px solid #ff9f4a;">
                    <div style="font-weight: 700; margin-bottom: 8px; color: #ff9f4a;">Ultra-Short Term Traders</div>
                    <div id="ultraShortInsight" style="color: #c0c0c0;">Loading...</div>
                </div>
                <div style="background: #252538; padding: 20px; border-radius: 8px; border-left: 4px solid #66cc66;">
                    <div style="font-weight: 700; margin-bottom: 8px; color: #66cc66;">Product Fit</div>
                    <div id="productFitInsight" style="color: #c0c0c0;">Loading...</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        async function loadData() {
            try {
                // Load all data files (60K dataset)
                const [messages, instruments, strategy] = await Promise.all([
                    fetch('stocktwits_mega100k_24h.json').then(r => r.json()),
                    fetch('mega100k_instrument_analysis.json').then(r => r.json()),
                    fetch('mega100k_strategy_analysis.json').then(r => r.json())
                ]);

                populateDashboard(messages, instruments, strategy);
            } catch (error) {
                console.error('Error loading data:', error);
            }
        }

        function populateDashboard(messages, instruments, strategy) {
            const summary = strategy.summary;
            
            // Coverage badge
            document.getElementById('coverageBadge').textContent = 
                `${messages.length.toLocaleString()} messages analyzed (~${instruments.coverage_estimate_pct}% platform coverage)`;

            // Stats
            const ultraShort = summary.timeframe_distribution['ultra_short_term'] || 0;
            const optionsUsers = instruments.instrument_preferences.options || 0;
            const highFit = summary.product_fit_distribution.very_high + summary.product_fit_distribution.high;
            const optionsPct = ((optionsUsers / instruments.total_users) * 100).toFixed(1);
            const ultraShortPct = ((ultraShort / summary.total_users_analyzed) * 100).toFixed(1);
            const highFitPct = ((highFit / summary.total_users_analyzed) * 100).toFixed(1);

            // iOS percentage
            let iosCount = 0;
            messages.forEach(msg => {
                const source = msg.source || '';
                if (source.includes('iOS') || source.includes('iPhone')) {
                    iosCount++;
                }
            });
            const iosPct = ((iosCount / messages.length) * 100).toFixed(1);

            document.getElementById('statsGrid').innerHTML = `
                <div class="stat-card">
                    <div class="stat-label">Total Messages</div>
                    <div class="stat-value">${messages.length.toLocaleString()}</div>
                    <div class="stat-subtext">${instruments.coverage_estimate_pct}% coverage</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Users Analyzed</div>
                    <div class="stat-value">${instruments.total_users.toLocaleString()}</div>
                    <div class="stat-subtext">${summary.total_users_analyzed} deep profiles</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Options Traders</div>
                    <div class="stat-value">${optionsPct}%</div>
                    <div class="stat-subtext">${optionsUsers.toLocaleString()} users</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Ultra-Short Term</div>
                    <div class="stat-value">${ultraShortPct}%</div>
                    <div class="stat-subtext">${ultraShort} day traders</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">iOS Users</div>
                    <div class="stat-value">${iosPct}%</div>
                    <div class="stat-subtext">${iosCount.toLocaleString()} posts</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">High Product Fit</div>
                    <div class="stat-value">${highFit}</div>
                    <div class="stat-subtext">${highFitPct}% of analyzed</div>
                </div>
            `;

            // Charts
            createTimeframeChart(summary.timeframe_distribution);
            createStrategyChart(summary.strategy_distribution);
            createInstrumentChart(instruments.instrument_preferences);
            createDeviceChart(messages);
            createTimingChart(messages);
            createProductFitChart(summary.product_fit_distribution);

            // Table
            populateTopTraders(strategy.profiles);

            // Insights
            document.getElementById('optionsInsight').textContent = 
                `${optionsUsers.toLocaleString()} users (${optionsPct}%) trade options with explicit language like "bought calls", "strike price", and "expiration". Up from 15.3% in smaller sample - more active users trade options! Core addressable market: ~250K users if 1M active on StockTwits.`;
            
            document.getElementById('ultraShortInsight').textContent = 
                `${ultraShort} users (${ultraShortPct}%) are ultra-short term traders (0-1 day holds). They use 0DTE options, scalp trades, and make multiple trades per day. Perfect fit for mobile in-app trading. ${iosPct}% already on iOS!`;
            
            document.getElementById('productFitInsight').textContent = 
                `${highFit} users (${highFitPct}%) have high/very-high product fit scores. These active traders would benefit most from instant mobile execution, real-time quotes, and 0DTE options. Conservative revenue: $4.3M ARR, Aggressive: $43M ARR.`;
        }

        function createTimeframeChart(data) {
            const ctx = document.getElementById('timeframeChart').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Ultra-Short (0-1d)', 'Short (1-7d)', 'Medium (1-12w)', 'Long (3m+)', 'Unknown'],
                    datasets: [{
                        data: [
                            data.ultra_short_term || 0,
                            data.short_term || 0,
                            data.medium_term || 0,
                            data.long_term || 0,
                            data.unknown || 0
                        ],
                        backgroundColor: ['#ff4444', '#ffaa44', '#66cc66', '#4a9eff', '#888888'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom', labels: { color: '#e0e0e0', padding: 12, font: { size: 11 } } }
                    }
                }
            });
        }

        function createStrategyChart(data) {
            const ctx = document.getElementById('strategyChart').getContext('2d');
            const sorted = Object.entries(data).sort((a, b) => b[1] - a[1]).slice(0, 6);
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: sorted.map(([k]) => k.replace(/_/g, ' ').split(' ').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' ')),
                    datasets: [{
                        data: sorted.map(([, v]) => v),
                        backgroundColor: '#4a9eff',
                        borderRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { grid: { color: '#2a2a3e' }, ticks: { color: '#e0e0e0' } },
                        y: { grid: { display: false }, ticks: { color: '#e0e0e0' } }
                    }
                }
            });
        }

        function createInstrumentChart(data) {
            const ctx = document.getElementById('instrumentChart').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Stocks Only', 'Crypto', 'Options', 'Leveraged ETF', 'Futures'],
                    datasets: [{
                        data: [
                            data.stocks_only || 0,
                            data.crypto || 0,
                            data.options || 0,
                            data.leveraged_etf || 0,
                            data.futures || 0
                        ],
                        backgroundColor: ['#888888', '#ff9f4a', '#4a9eff', '#66cc66', '#cc66cc'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom', labels: { color: '#e0e0e0', padding: 12, font: { size: 11 } } }
                    }
                }
            });
        }

        function createDeviceChart(messages) {
            // Extract device info from source field
            const devices = { 'Web': 0, 'iOS': 0, 'Android': 0, 'Mobile Web': 0, 'Other': 0 };
            
            messages.forEach(msg => {
                const source = msg.source || '';
                if (source.includes('Web') && !source.includes('Mobile')) {
                    devices['Web']++;
                } else if (source.includes('iOS') || source.includes('iPhone')) {
                    devices['iOS']++;
                } else if (source.includes('Android')) {
                    devices['Android']++;
                } else if (source.includes('Mobile')) {
                    devices['Mobile Web']++;
                } else {
                    devices['Other']++;
                }
            });

            const ctx = document.getElementById('deviceChart').getContext('2d');
            new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: Object.keys(devices),
                    datasets: [{
                        data: Object.values(devices),
                        backgroundColor: ['#4a9eff', '#ff9f4a', '#66cc66', '#cc66cc', '#888888'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom', labels: { color: '#e0e0e0', padding: 12, font: { size: 11 } } }
                    }
                }
            });
        }

        function createTimingChart(messages) {
            const timing = { 'Pre Market': 0, 'Market Hours': 0, 'After Hours': 0, 'Off Hours': 0 };
            
            messages.forEach(msg => {
                const timestamp = new Date(msg.created_at);
                const hour = timestamp.getUTCHours() - 4; // EST
                const adjustedHour = hour < 0 ? hour + 24 : hour;
                
                if (adjustedHour >= 7 && adjustedHour < 9.5) timing['Pre Market']++;
                else if (adjustedHour >= 9.5 && adjustedHour < 16) timing['Market Hours']++;
                else if (adjustedHour >= 16 && adjustedHour < 20) timing['After Hours']++;
                else timing['Off Hours']++;
            });

            const ctx = document.getElementById('timingChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.keys(timing),
                    datasets: [{
                        data: Object.values(timing),
                        backgroundColor: ['#ffaa44', '#4a9eff', '#66cc66', '#888888'],
                        borderRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { grid: { color: '#2a2a3e' }, ticks: { color: '#e0e0e0' } },
                        x: { grid: { display: false }, ticks: { color: '#e0e0e0' } }
                    }
                }
            });
        }

        function createProductFitChart(data) {
            const ctx = document.getElementById('productFitChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Very High', 'High', 'Medium', 'Low'],
                    datasets: [{
                        data: [data.very_high, data.high, data.medium, data.low],
                        backgroundColor: ['#ff4444', '#ffaa44', '#66cc66', '#888888'],
                        borderRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { grid: { color: '#2a2a3e' }, ticks: { color: '#e0e0e0' } },
                        x: { grid: { display: false }, ticks: { color: '#e0e0e0' } }
                    }
                }
            });
        }

        function populateTopTraders(profiles) {
            const top20 = profiles.slice(0, 20);
            const html = top20.map((p, i) => {
                const timeframeClass = p.timeframe.primary.includes('ultra') ? 'badge-ultra' :
                                      p.timeframe.primary.includes('short') ? 'badge-short' :
                                      p.timeframe.primary.includes('medium') ? 'badge-medium' : 'badge-long';
                
                return `
                    <tr>
                        <td><strong>${i + 1}</strong></td>
                        <td><a href="https://stocktwits.com/${p.username}" class="user-link" target="_blank">@${p.username}</a></td>
                        <td><strong>${p.product_fit_score}</strong>/100</td>
                        <td><span class="badge ${timeframeClass}">${p.timeframe.primary.replace(/_/g, ' ')}</span></td>
                        <td>${p.strategy.primary.replace(/_/g, ' ')}</td>
                        <td>${p.risk_profile.category}</td>
                        <td>${p.total_posts}</td>
                        <td><a href="https://stocktwits.com/${p.username}" class="user-link" target="_blank">View</a></td>
                    </tr>
                `;
            }).join('');
            
            document.getElementById('topTradersTable').innerHTML = html;
        }

        // Load on page load
        loadData();
    </script>
</body>
</html>

